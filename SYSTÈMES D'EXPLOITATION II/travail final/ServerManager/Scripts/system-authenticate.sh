#/bin/bash
# Doit retourner 1 si les informations sont valides, 0 sinon
# Le mot de passe est hashé avec sha1, afin d'éviter de le laisser en "clear text" dans ce fichier.
# $1 = nom d'usager entré au clavier
# $2 = mot de passe hashé avec sha1

# créer le fichier txt s'il n'existe pas
if [ ! -f "$file" ]; then
    echo "0" > "$file"
fi

file="try.txt"

# lis la valeur du compteur
compteur=$(($(cat "$file") + 1))

# Vérifie si le compte est déjà verrouillé, alors direct exit 
if sudo passwd -S "$1" | grep -q "L"; then
    echo "0"
    exit 
fi

# Vérifie le log in
if [ "$1" = "sshAdmin" ] && [ "$2" = "4dc588251457d8078a39f8e8e0f98053e51250c5" ]; then
    echo "1"  # Valide
    echo "0" > "$file"  # reset le compteur et doit manuellement unlock le user sshAdmin
else
    echo "0"  # Invalide

    echo "$compteur" > "$file"  # update la valeur du compteur

    if [ "$(cat "$file")" -ge 3 ]; then
        echo "-1"
        sudo usermod -L "$1"  # bloque le compte
    fi
fi


