#!/bin/bash

corruption=false
cheminCorruption=""

for dir in /home/*/CVManager/*/
do
    if [ "$dir" != "/home/cvmgroup/" ]
    then
        for file in "$dir"*
        do
            if [ -f "$file" ]
            then
                if grep -q 'shell_exec' "$file" && grep -q 'su' "$file"
                then
                    corruption=true
                    echo "Le serveur est corrompu."
                    echo "Fichier corrompu : $file"
                    cheminCorruption+="\n- $file"
                    
                fi
            fi
        done
    fi
done

if [ "$corruption" = false ]
then
    echo "Serveur int√®gre."
else
 echo -e "Le serveur est corrompu. Fichiers corrompus :$corrupted_files"
fi
